# ğŸ—„ï¸ Diagrama do Banco de Dados - AITRON Financeira Multi-Tenant

## ğŸ“Š VisÃ£o Geral da Estrutura

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         NÃVEL SYSTEM                                 â”‚
â”‚                    (Gerenciado pela AITRON)                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  users (tenantId = NULL)                                    â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  id: uuid (PK)                                             â”‚   â”‚
â”‚  â”‚  email: "fabio@aitron.com.br"                             â”‚   â”‚
â”‚  â”‚  role: "super_admin"                                       â”‚   â”‚
â”‚  â”‚  tenantId: NULL  â† SEM TENANT!                            â”‚   â”‚
â”‚  â”‚  passwordHash: ...                                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  ğŸ‘‘ Super Admins:                                                   â”‚
â”‚  - fabio@aitron.com.br / SuperAdmin@123                            â”‚
â”‚  - suporte@aitron.com.br / Suporte@123                             â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ cria e gerencia
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        NÃVEL TENANT                                  â”‚
â”‚                   (Empresas Clientes da AITRON)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  tenants                                                    â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  id: "tenant-uuid-1" (PK)                                  â”‚   â”‚
â”‚  â”‚  name: "Empresa Exemplo"                                   â”‚   â”‚
â”‚  â”‚  email: "exemplo@empresa.com.br"                           â”‚   â”‚
â”‚  â”‚  cpfCnpj: "12345678000190"                                 â”‚   â”‚
â”‚  â”‚  plan: "pro" | "free"                                      â”‚   â”‚
â”‚  â”‚  status: "active" | "past_due" | "suspended" | "canceled"  â”‚   â”‚
â”‚  â”‚  trialStartAt: 2025-10-01                                  â”‚   â”‚
â”‚  â”‚  trialEndAt: 2025-10-16 (15 dias)                         â”‚   â”‚
â”‚  â”‚  nextDueAt: 2025-11-01                                     â”‚   â”‚
â”‚  â”‚  billingMethod: "pix" | "credit_card"                      â”‚   â”‚
â”‚  â”‚  addressId: uuid (FK â†’ addresses)                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                      â”‚
â”‚                               â”‚ tem                                  â”‚
â”‚                               â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  subscription_invoices                                      â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  id: uuid (PK)                                             â”‚   â”‚
â”‚  â”‚  tenantId: "tenant-uuid-1" (FK â†’ tenants)                 â”‚   â”‚
â”‚  â”‚  periodStart: 2025-10-01                                   â”‚   â”‚
â”‚  â”‚  periodEnd: 2025-10-31                                     â”‚   â”‚
â”‚  â”‚  dueDate: 2025-11-05                                       â”‚   â”‚
â”‚  â”‚  amount: 49.90                                             â”‚   â”‚
â”‚  â”‚  method: "pix"                                             â”‚   â”‚
â”‚  â”‚  status: "open" | "paid" | "overdue" | "canceled"         â”‚   â”‚
â”‚  â”‚  paidAt: null                                              â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  subscription_events                                        â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  id: uuid (PK)                                             â”‚   â”‚
â”‚  â”‚  tenantId: "tenant-uuid-1" (FK â†’ tenants)                 â”‚   â”‚
â”‚  â”‚  type: "trial_started" | "payment_succeeded" |             â”‚   â”‚
â”‚  â”‚        "payment_failed" | "account_suspended"              â”‚   â”‚
â”‚  â”‚  data: { ... } (JSONB)                                     â”‚   â”‚
â”‚  â”‚  createdAt: timestamp                                       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ tem
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NÃVEL USUÃRIOS DO TENANT                          â”‚
â”‚              (Equipe que trabalha na Empresa Exemplo)               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  users (tenantId = "tenant-uuid-1")                        â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  id: "user-uuid-1" (PK)                                    â”‚   â”‚
â”‚  â”‚  tenantId: "tenant-uuid-1" (FK â†’ tenants) â† COM TENANT!   â”‚   â”‚
â”‚  â”‚  email: "fabiowebmain@gmail.com"                           â”‚   â”‚
â”‚  â”‚  role: "admin" | "operator" | "viewer"                     â”‚   â”‚
â”‚  â”‚  name: "Fabio Web"                                         â”‚   â”‚
â”‚  â”‚  passwordHash: ...                                         â”‚   â”‚
â”‚  â”‚  addressId: uuid (FK â†’ addresses)                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  Exemplo de usuÃ¡rios:                                               â”‚
â”‚  â€¢ Admin: fabiowebmain@gmail.com (cria tudo)                       â”‚
â”‚  â€¢ Operator: operador@empresa.com (cria clientes/emprÃ©stimos)      â”‚
â”‚  â€¢ Viewer: viewer@empresa.com (apenas lÃª)                          â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ cadastra e gerencia
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      NÃVEL CLIENTES                                  â”‚
â”‚            (Pessoas que PEGAM emprÃ©stimos - NÃƒO fazem login)       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  clients                                                    â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  id: "client-uuid-1" (PK)                                  â”‚   â”‚
â”‚  â”‚  tenantId: "tenant-uuid-1" (FK â†’ tenants)                 â”‚   â”‚
â”‚  â”‚  name: "JoÃ£o da Silva"                                     â”‚   â”‚
â”‚  â”‚  firstName: "JoÃ£o"                                         â”‚   â”‚
â”‚  â”‚  lastName: "Silva"                                         â”‚   â”‚
â”‚  â”‚  email: "joao@email.com"                                   â”‚   â”‚
â”‚  â”‚  document: "12345678900"                                   â”‚   â”‚
â”‚  â”‚  documentType: "cpf" | "cnpj"                              â”‚   â”‚
â”‚  â”‚  phone: "11999998888"                                      â”‚   â”‚
â”‚  â”‚  birthDate: 1990-05-15                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                      â”‚
â”‚                               â”‚ tem                                  â”‚
â”‚                               â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  addresses (para clients)                                   â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  id: uuid (PK)                                             â”‚   â”‚
â”‚  â”‚  clientId: "client-uuid-1" (FK â†’ clients)                 â”‚   â”‚
â”‚  â”‚  userId: NULL                                              â”‚   â”‚
â”‚  â”‚  postalCode: "01310100"                                    â”‚   â”‚
â”‚  â”‚  street: "Av. Paulista"                                    â”‚   â”‚
â”‚  â”‚  number: "1578"                                            â”‚   â”‚
â”‚  â”‚  district: "Bela Vista"                                    â”‚   â”‚
â”‚  â”‚  city: "SÃ£o Paulo"                                         â”‚   â”‚
â”‚  â”‚  state: "SP"                                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ recebe
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    NÃVEL EMPRÃ‰STIMOS                                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  accounts (contas bancÃ¡rias do tenant)                     â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  id: "account-uuid-1" (PK)                                 â”‚   â”‚
â”‚  â”‚  tenantId: "tenant-uuid-1" (FK â†’ tenants)                 â”‚   â”‚
â”‚  â”‚  userId: "user-uuid-1" (FK â†’ users)                       â”‚   â”‚
â”‚  â”‚  name: "Conta Principal"                                   â”‚   â”‚
â”‚  â”‚  bankName: "Banco do Brasil"                               â”‚   â”‚
â”‚  â”‚  type: "checking" | "savings"                              â”‚   â”‚
â”‚  â”‚  currentBalance: 100000.00                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                      â”‚
â”‚                               â”‚ financia                             â”‚
â”‚                               â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  loans                                                      â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  id: "loan-uuid-1" (PK)                                    â”‚   â”‚
â”‚  â”‚  tenantId: "tenant-uuid-1" (FK â†’ tenants)                 â”‚   â”‚
â”‚  â”‚  clientId: "client-uuid-1" (FK â†’ clients)                 â”‚   â”‚
â”‚  â”‚  accountId: "account-uuid-1" (FK â†’ accounts)              â”‚   â”‚
â”‚  â”‚  createdByUserId: "user-uuid-1" (FK â†’ users)              â”‚   â”‚
â”‚  â”‚  principalAmount: 5000.00                                  â”‚   â”‚
â”‚  â”‚  interestRate: 5.5                                         â”‚   â”‚
â”‚  â”‚  dueDate: 2025-12-01                                       â”‚   â”‚
â”‚  â”‚  status: "active" | "overdue" | "paid" | "written_off"    â”‚   â”‚
â”‚  â”‚  notes: "EmprÃ©stimo para capital de giro"                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                      â”‚
â”‚                               â”‚ dividido em                          â”‚
â”‚                               â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  loan_installments                                          â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  id: uuid (PK)                                             â”‚   â”‚
â”‚  â”‚  loanId: "loan-uuid-1" (FK â†’ loans)                       â”‚   â”‚
â”‚  â”‚  sequence: 1, 2, 3...                                      â”‚   â”‚
â”‚  â”‚  dueDate: 2025-11-01, 2025-12-01...                       â”‚   â”‚
â”‚  â”‚  principalDue: 1666.67                                     â”‚   â”‚
â”‚  â”‚  interestDue: 91.67                                        â”‚   â”‚
â”‚  â”‚  totalDue: 1758.34                                         â”‚   â”‚
â”‚  â”‚  paidAmount: 0.00                                          â”‚   â”‚
â”‚  â”‚  status: "pending" | "paid" | "overdue"                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                      â”‚
â”‚                               â”‚ recebe                               â”‚
â”‚                               â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  payments                                                   â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  id: uuid (PK)                                             â”‚   â”‚
â”‚  â”‚  loanId: "loan-uuid-1" (FK â†’ loans)                       â”‚   â”‚
â”‚  â”‚  accountId: "account-uuid-1" (FK â†’ accounts)              â”‚   â”‚
â”‚  â”‚  amount: 1758.34                                           â”‚   â”‚
â”‚  â”‚  paymentDate: 2025-11-05                                   â”‚   â”‚
â”‚  â”‚  type: "installment" | "early" | "late"                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                               â”‚                                      â”‚
â”‚                               â”‚ associado a                          â”‚
â”‚                               â–¼                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  installment_payments                                       â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  installmentId: uuid (FK â†’ loan_installments)              â”‚   â”‚
â”‚  â”‚  paymentId: uuid (FK â†’ payments)                           â”‚   â”‚
â”‚  â”‚  amount: 1758.34                                           â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  account_transactions                                       â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  id: uuid (PK)                                             â”‚   â”‚
â”‚  â”‚  accountId: "account-uuid-1" (FK â†’ accounts)              â”‚   â”‚
â”‚  â”‚  loanId: "loan-uuid-1" (FK â†’ loans) [opcional]            â”‚   â”‚
â”‚  â”‚  paymentId: uuid (FK â†’ payments) [opcional]                â”‚   â”‚
â”‚  â”‚  direction: "credit" | "debit"                             â”‚   â”‚
â”‚  â”‚  amount: 5000.00                                           â”‚   â”‚
â”‚  â”‚  description: "EmprÃ©stimo concedido para JoÃ£o"            â”‚   â”‚
â”‚  â”‚  occurredAt: timestamp                                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”— Relacionamentos Principais

```
users (tenantId = NULL)  â† SUPER ADMIN
    â†“ cria e gerencia
tenants
    â†“ tem
    â”œâ”€â†’ users (tenantId = uuid)  â† USUÃRIOS DO TENANT
    â”œâ”€â†’ clients (tenantId = uuid)  â† CLIENTES
    â”œâ”€â†’ accounts (tenantId = uuid)  â† CONTAS
    â”œâ”€â†’ loans (tenantId = uuid)  â† EMPRÃ‰STIMOS
    â”œâ”€â†’ subscription_invoices
    â”œâ”€â†’ subscription_events
    â””â”€â†’ tickets

clients
    â†“ recebe
loans
    â†“ dividido em
loan_installments
    â†“ recebe
payments â†’ installment_payments
```

---

## ğŸ“‹ Tabela de ReferÃªncia RÃ¡pida

| Tabela | tenantId? | Quem cria? | Exemplo |
|--------|-----------|------------|---------|
| **users** (super_admin) | âŒ NULL | Sistema (seed) | fabio@aitron.com.br |
| **tenants** | - | Super Admin | Empresa Exemplo |
| **users** (tenant) | âœ… UUID | Super Admin ou Tenant Admin | fabiowebmain@gmail.com |
| **clients** | âœ… UUID | UsuÃ¡rios do Tenant | JoÃ£o da Silva |
| **accounts** | âœ… UUID | UsuÃ¡rios do Tenant | Conta Principal |
| **loans** | âœ… UUID | UsuÃ¡rios do Tenant | EmprÃ©stimo #001 |
| **loan_installments** | âŒ (herda do loan) | Sistema automÃ¡tico | Parcela 1/12 |
| **payments** | âŒ (herda do loan) | UsuÃ¡rios do Tenant | Pagamento R$ 1.758,34 |
| **subscription_invoices** | âœ… UUID | Sistema (cron) | Fatura Out/2025 |
| **subscription_events** | âœ… UUID | Sistema | trial_started |
| **tickets** | âœ… UUID | UsuÃ¡rios do Tenant | Ticket #001 |
| **ticket_messages** | âŒ (herda do ticket) | Tenant ou Super Admin | "Preciso de ajuda..." |

---

## ğŸ¯ Exemplos PrÃ¡ticos de Queries

### 1ï¸âƒ£ Super Admin busca TODOS os tenants
```sql
SELECT * FROM tenants;
-- âœ… Retorna TODOS (sem filtro de tenantId)
```

### 2ï¸âƒ£ UsuÃ¡rio Tenant busca clientes
```sql
-- Token contÃ©m: tenantId = "tenant-uuid-1"
SELECT * FROM clients WHERE tenantId = 'tenant-uuid-1';
-- âœ… Retorna APENAS clientes do seu tenant
```

### 3ï¸âƒ£ UsuÃ¡rio Tenant busca emprÃ©stimos
```sql
SELECT
  l.*,
  c.name as client_name,
  a.name as account_name
FROM loans l
JOIN clients c ON l.clientId = c.id
JOIN accounts a ON l.accountId = a.id
WHERE l.tenantId = 'tenant-uuid-1';
-- âœ… EmprÃ©stimos + Clientes + Contas do MESMO tenant
```

### 4ï¸âƒ£ Criar emprÃ©stimo (com auditoria)
```sql
INSERT INTO loans (
  id, tenantId, clientId, accountId, createdByUserId,
  principalAmount, interestRate, dueDate, status
) VALUES (
  uuid_generate_v4(),
  'tenant-uuid-1',  -- â† Tenant do usuÃ¡rio
  'client-uuid-1',   -- â† Cliente do tenant
  'account-uuid-1',  -- â† Conta do tenant
  'user-uuid-1',     -- â† Quem criou (auditoria)
  5000.00,
  5.5,
  '2025-12-01',
  'active'
);
```

---

## ğŸ”’ Constraints de SeguranÃ§a

### âœ… Garantias do Banco

1. **Isolamento por Tenant:**
```sql
-- Ãndices para performance
CREATE INDEX idx_clients_tenant ON clients(tenantId);
CREATE INDEX idx_loans_tenant ON loans(tenantId);
CREATE INDEX idx_accounts_tenant ON accounts(tenantId);
```

2. **Integridade Referencial:**
```sql
-- Cliente deve pertencer ao mesmo tenant do emprÃ©stimo
ALTER TABLE loans
  ADD CONSTRAINT fk_loan_client_tenant
  CHECK (
    (SELECT tenantId FROM clients WHERE id = clientId) = tenantId
  );
```

3. **UsuÃ¡rios Super Admin:**
```sql
-- Super Admin NÃƒO tem tenant
ALTER TABLE users
  ADD CONSTRAINT chk_super_admin_no_tenant
  CHECK (
    (role = 'super_admin' AND tenantId IS NULL) OR
    (role != 'super_admin' AND tenantId IS NOT NULL)
  );
```

---

## ğŸ“Š Exemplo Completo: Tenant "Empresa Exemplo"

```
TENANT: Empresa Exemplo (tenant-uuid-1)
  â”‚
  â”œâ”€ USUÃRIOS (fazem login)
  â”‚  â”œâ”€ fabiowebmain@gmail.com (admin)
  â”‚  â”œâ”€ operador@empresa.com (operator)
  â”‚  â””â”€ viewer@empresa.com (viewer)
  â”‚
  â”œâ”€ CONTAS BANCÃRIAS
  â”‚  â”œâ”€ Conta Principal (R$ 100.000,00)
  â”‚  â””â”€ Conta Reserva (R$ 50.000,00)
  â”‚
  â”œâ”€ CLIENTES (NÃƒO fazem login)
  â”‚  â”œâ”€ JoÃ£o da Silva (CPF: 123.456.789-00)
  â”‚  â”‚  â””â”€ EmprÃ©stimos:
  â”‚  â”‚     â”œâ”€ R$ 5.000 (3x) - Status: active
  â”‚  â”‚     â””â”€ R$ 2.000 (12x) - Status: paid
  â”‚  â”‚
  â”‚  â”œâ”€ Maria Oliveira (CPF: 987.654.321-00)
  â”‚  â”‚  â””â”€ EmprÃ©stimos:
  â”‚  â”‚     â””â”€ R$ 10.000 (6x) - Status: overdue
  â”‚  â”‚
  â”‚  â””â”€ Empresa XYZ Ltda (CNPJ: 12.345.678/0001-90)
  â”‚     â””â”€ EmprÃ©stimos:
  â”‚        â””â”€ R$ 50.000 (24x) - Status: active
  â”‚
  â””â”€ ASSINATURA
     â”œâ”€ Plano: PRO (R$ 49,90/mÃªs)
     â”œâ”€ Status: active
     â”œâ”€ Trial: 15 dias (jÃ¡ expirado)
     â”œâ”€ PrÃ³ximo vencimento: 01/11/2025
     â””â”€ MÃ©todo: PIX
```

---

## âœ… Checklist de Entendimento

Responda mentalmente:

- [ ] Entendo que **Super Admin NÃƒO tem tenantId**
- [ ] Entendo que **UsuÃ¡rios do Tenant TÃŠM tenantId**
- [ ] Entendo que **Clientes NÃƒO fazem login** (apenas cadastrados)
- [ ] Entendo que **TODAS as tabelas de negÃ³cio** tÃªm `tenantId`
- [ ] Entendo que **middleware filtra automaticamente** por `tenantId`
- [ ] Entendo que **Super Admin Ã© exceÃ§Ã£o** (vÃª todos os tenants)

---

Ficou claro agora? Quer que eu explique alguma parte especÃ­fica mais detalhadamente?
